==Basic Installation Instructions==

===Prerequisites===

1. PostgreSQL > 8.2
2. Apache2 Webserver
3. PHP 5

sudo apt-get install libapache2-mod-php5 php5-pgsql imagemagick

== Ubuntu 10.10 ==

The git repository is hosted here::

	http://pacific.mpi-cbg.de/cgi-bin/gitweb.cgi

0. Clone the repository into /var/www/catmaid so that you have
the folder /var/www/catmaid/httpdocs/ in place

1. PostgresSQL

https://help.ubuntu.com/community/PostgreSQL

	sudo apt-get install postgresql pgadmin3 phppgadmin postgresql-contrib

Update the password for your catmaid user in /var/www/catmaid/docs/createuser.sql

	sudo -u postgres psql < docs/createuser.sql

Check if you can login - the database should still be empty, however:

	http://localhost/phppgadmin/

Make sure that the catmaid database is accessible using MD5 hashed
passwords - you have to add this line as the *first* rule in
/etc/postgresql/8.4/main/pg_hba.conf:

	local   catmaid     catmaid_user          md5

After the above please restart the database:

  sudo /etc/init.d/posgresql-8.4 restart

Update catmaid database connection for user in
inc/setup.inc.php.template and rename the file to
inc/setup.inc

2. Apache2 Server

There are two possibilities here - setting up CATMAID on
its own virtual host, or setting it up as a subdirectory
of an existing host:

2.1 Named Virtual Hosts approach:

http://wiki.ubuntuusers.de/Apache/Virtual_Hosts

Your clone of the CATMAID source code should be *outside* any
web-accessible directory.  For example, let's say that you have the
source code in /home/bob/catmaid/

Create a directory for the log files, for example with:

   sudo mkdir -p /var/log/apache2/catmaid/

Create in /etc/apache2/sites-available a file called "catmaid":
----
<VirtualHost *:80>
    ServerName catmaid

    DocumentRoot "/home/bob/catmaid/httpdocs/"

    php_admin_value register_globals off
    php_admin_value include_path ".:/home/bob/catmaid/inc"
    php_admin_value session.use_only_cookies 1
    php_admin_value error_reporting 2047
    php_admin_value display_errors true

    <Directory /home/bob/catmaid/httpdocs/>

        Options FollowSymLinks
        AllowOverride AuthConfig Limit FileInfo

        Order allow,deny
        allow from all

    </Directory>

    CustomLog /var/log/apache2/catmaid/access_log combined
    ErrorLog /var/log/apache2/catmaid/error.log

</VirtualHost>
---

... then make apache aware of the virtual host:
	sudo a2ensite catmaid

... then restart apache:
	/etc/init.d/apache2 restart

... and finally add this entry to "/etc/hosts" :

127.0.0.1	catmaid


2.2 As a directory of an existing virtual host

<VirtualHost *:80>
        ServerAdmin webmaster@localhost

        DocumentRoot /var/www
        <Directory />
                Options FollowSymLinks
                AllowOverride None
        </Directory>
	...
	...

	# Add CATMAID configuration here:
        # CATMAID stuff:
        php_admin_value register_globals off
        php_admin_value include_path ".:/home/mark/catmaid-local-instance/inc"
        php_admin_value session.use_only_cookies 1
        php_admin_value error_reporting 2047
        php_admin_value display_errors true

        Alias /catmaid/ /home/mark/catmaid-local-instance/httpdocs/
        <Directory /home/mark/catmaid-local-instance/httpdocs/>
                Options FollowSymLinks
                AllowOverride AuthConfig Limit FileInfo
                Order allow,deny
                Allow from all
        </Directory>

	...
	...
</VirtualHost>


3. Now try it out!

Try to start CATMAID::

	firefox http://catmaid/

... or with:

        firefox http://localhost/catmaid/

... depending on the approach you took above.  You will get an error
to tell you that no projects are found.  If you want to create some
example projects, stacks and a user account for testing, you should do:

        psql -U catmaid_user < docs/example-projects.sql

Then you can use the default login::

	user: gerhard
	pass: gerhard

4. Adding a new project

Currently, adding a new project and stacks within that project is
still a largely manual process.  You can generate the image tiles for
a stack with the scripts/tile_stack script or by exporting from
TrakEM2 with its "Export > Flat Images" option and selecting the
"Export for web" checkbox.

Then you will need to add at least one row to the following tables:

  project - to define a new project.  A project is like the coordinate
            space for a particular subject, which can have many stacks
            added to it - e.g. one for electon microscope imagery, one for
	    a registered light microscope image stack, etc.

  stack - to define the properties of a particular stack of images
          within the project

  project_stack - a join table to indicate that the stack is part of that
                  project

  project_user - a join table to indicate that that user may annotate
                 that project

5. Enabling skeleton and synapse annotation

To enable the new SVG-based skeleton and synapse annotation features
at the moment, you need to add some classes and relations to your new
project.  Also you will need to add a root class_instance.

You can copy the insert statments in docs/master.sql that begin at
"COPY class ..." and "COPY class_instance ..." but with your new
project_id.  More details about the data model can be found in
docs/data-model.lyx - a PDF generated from that file can be found here:

  http://incf.ini.uzh.ch/docs/catmaid-data-model.pdf
